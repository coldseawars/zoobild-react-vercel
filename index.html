<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZooBild - Professioneller Bildkonfigurator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AQlDw5JyJD8mZT_IKXuaJC6TgO8C6vN6R2-v4T8TK1fJK_3sJf-_k9l6P_wGXnFHByUFqz1fZ1G3X3YT&currency=EUR"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 300;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .main-content {
      padding: 40px;
    }

    .search-section {
      text-align: center;
      margin-bottom: 40px;
    }

    .search-input {
      font-size: 1.2rem;
      padding: 15px 25px;
      border: 2px solid #ddd;
      border-radius: 50px;
      width: 300px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      margin-left: 10px;
      border-radius: 50px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .search-btn:hover {
      transform: translateY(-2px);
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }

    .image-card {
      border: 2px solid #eee;
      border-radius: 15px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .image-card:hover {
      border-color: #667eea;
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .image-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .image-info {
      padding: 15px;
      text-align: center;
    }

    .configurator {
      display: none;
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin: 40px 0;
    }

    .config-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: start;
    }

    .preview-canvas {
      border: 2px solid #ddd;
      border-radius: 10px;
      max-width: 100%;
      height: auto;
    }

    .options-panel {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .option-group {
      margin-bottom: 25px;
    }

    .option-group h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
    }

    .option-item {
      border: 2px solid #eee;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .option-item:hover,
    .option-item.selected {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .add-to-cart-btn {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: transform 0.2s ease;
    }

    .add-to-cart-btn:hover {
      transform: translateY(-2px);
    }

    .cart-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin: 40px 0;
    }

    .cart-item {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .error {
      background: #ff6b6b;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }

    .success {
      background: #51cf66;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }

    @media (max-width: 768px) {
      .config-grid {
        grid-template-columns: 1fr;
      }
      
      .search-input {
        width: 100%;
        margin-bottom: 10px;
      }
      
      .search-btn {
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ZooBild Konfigurator</h1>
      <p>Professionelle Tierfotografie - Konfigurieren Sie Ihre Bilder</p>
    </div>

    <div class="main-content">
      <!-- Suchbereich -->
      <div class="search-section">
        <input type="text" class="search-input" placeholder="8-stelliger Fotocode (z.B. 1XPK0901)" maxlength="8" id="photoCode">
        <button class="search-btn" onclick="searchPhotos()">Fotos suchen</button>
      </div>

      <!-- Ladeanzeige -->
      <div id="loading" class="loading" style="display: none;">
        <p>Suche Fotos...</p>
      </div>

      <!-- Fehlermeldung -->
      <div id="error" class="error" style="display: none;"></div>

      <!-- Bildergalerie -->
      <div id="gallery" class="gallery"></div>

      <!-- Konfigurator -->
      <div id="configurator" class="configurator">
        <div class="config-grid">
          <!-- Vorschau -->
          <div>
            <h3>Vorschau</h3>
            <canvas id="previewCanvas" class="preview-canvas" width="400" height="300"></canvas>
          </div>

          <!-- Optionen -->
          <div class="options-panel">
            <!-- Produkttyp -->
            <div class="option-group">
              <h3>Produkttyp</h3>
              <div class="option-grid">
                <div class="option-item selected" data-type="digital-single" onclick="selectProductType(this)">
                  <div>Digital</div>
                  <small>€9,95</small>
                </div>
                <div class="option-item" data-type="print-glossy-13x18" onclick="selectProductType(this)">
                  <div>Print 13x18</div>
                  <small>€12,95</small>
                </div>
              </div>
            </div>

            <!-- Rahmen -->
            <div class="option-group">
              <h3>Rahmen</h3>
              <div class="option-grid" id="frameOptions">
                <div class="option-item selected" data-frame="none" onclick="selectFrame(this)">Kein Rahmen</div>
              </div>
            </div>

            <!-- Motive -->
            <div class="option-group">
              <h3>Motive</h3>
              <div class="option-grid" id="motifOptions">
                <div class="option-item selected" data-motif="none" onclick="selectMotif(this)">Kein Motiv</div>
              </div>
            </div>

            <button class="add-to-cart-btn" onclick="addToCart()">In den Warenkorb</button>
          </div>
        </div>
      </div>

      <!-- Warenkorb -->
      <div id="cartSection" class="cart-section" style="display: none;">
        <h3>Warenkorb</h3>
        <div id="cartItems"></div>
        <div style="text-align: right; margin-top: 20px;">
          <strong>Gesamt: <span id="cartTotal">€0,00</span></strong>
          <button class="add-to-cart-btn" onclick="checkout()" style="width: auto; margin-left: 15px;">Zur Kasse</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Globale Variablen
    let currentImages = [];
    let selectedImage = null;
    let currentConfig = {
      productType: 'digital-single',
      frame: 'none',
      motif: 'none'
    };
    let cart = [];

    // Preisdaten (vereinfacht für Demo)
    const PRICING = {
      'digital-single': 9.95,
      'digital-collection': 19.95,
      'print-glossy-13x18': 12.95,
      'print-glossy-20x30': 24.95,
      'print-silk-13x18': 14.95,
      'print-silk-20x30': 26.95
    };

    // Foto-Suche
    async function searchPhotos() {
      const code = document.getElementById('photoCode').value.trim();
      if (!code || code.length !== 8) {
        showError('Bitte geben Sie einen 8-stelligen Fotocode ein');
        return;
      }

      showLoading(true);
      hideError();

      try {
        // Simulierte API-Anfrage (in echtem System würde hier die ZooBild-API aufgerufen)
        const response = await simulateImageSearch(code);
        currentImages = response;
        displayGallery(response);
      } catch (error) {
        showError('Fehler beim Laden der Bilder: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    // Simulierte Bildsuche (in echtem System: ZooBild-API)
    async function simulateImageSearch(code) {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve([
            {
              id: 1,
              code: code,
              filename: `${code}_001.jpg`,
              url: `https://via.placeholder.com/400x300/667eea/ffffff?text=${code}_001`,
              thumbnailUrl: `https://via.placeholder.com/200x150/667eea/ffffff?text=${code}_001`
            },
            {
              id: 2,
              code: code,
              filename: `${code}_002.jpg`,
              url: `https://via.placeholder.com/400x300/764ba2/ffffff?text=${code}_002`,
              thumbnailUrl: `https://via.placeholder.com/200x150/764ba2/ffffff?text=${code}_002`
            }
          ]);
        }, 1000);
      });
    }

    // Galerie anzeigen
    function displayGallery(images) {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';

      images.forEach(image => {
        const card = document.createElement('div');
        card.className = 'image-card';
        card.onclick = () => selectImage(image);
        card.innerHTML = `
          <img src="${image.thumbnailUrl}" alt="${image.filename}">
          <div class="image-info">
            <strong>${image.filename}</strong>
          </div>
        `;
        gallery.appendChild(card);
      });
    }

    // Bild auswählen
    function selectImage(image) {
      selectedImage = image;
      document.getElementById('configurator').style.display = 'block';
      updatePreview();
      loadFramesAndMotifs();
    }

    // Rahmen und Motive laden
    function loadFramesAndMotifs() {
      // Vereinfachte Rahmen
      const frames = [
        { id: 'none', name: 'Kein Rahmen' },
        { id: 'classic', name: 'Klassisch' },
        { id: 'modern', name: 'Modern' }
      ];

      const frameOptions = document.getElementById('frameOptions');
      frameOptions.innerHTML = '';
      frames.forEach(frame => {
        const option = document.createElement('div');
        option.className = 'option-item' + (frame.id === 'none' ? ' selected' : '');
        option.setAttribute('data-frame', frame.id);
        option.onclick = () => selectFrame(option);
        option.textContent = frame.name;
        frameOptions.appendChild(option);
      });

      // Vereinfachte Motive
      const motifs = [
        { id: 'none', name: 'Kein Motiv' },
        { id: 'heart', name: 'Herz' },
        { id: 'star', name: 'Stern' }
      ];

      const motifOptions = document.getElementById('motifOptions');
      motifOptions.innerHTML = '';
      motifs.forEach(motif => {
        const option = document.createElement('div');
        option.className = 'option-item' + (motif.id === 'none' ? ' selected' : '');
        option.setAttribute('data-motif', motif.id);
        option.onclick = () => selectMotif(option);
        option.textContent = motif.name;
        motifOptions.appendChild(option);
      });
    }

    // Produkttyp auswählen
    function selectProductType(element) {
      document.querySelectorAll('[data-type]').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      currentConfig.productType = element.getAttribute('data-type');
      updatePreview();
    }

    // Rahmen auswählen
    function selectFrame(element) {
      document.querySelectorAll('[data-frame]').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      currentConfig.frame = element.getAttribute('data-frame');
      updatePreview();
    }

    // Motiv auswählen
    function selectMotif(element) {
      document.querySelectorAll('[data-motif]').forEach(el => el.classList.remove('selected'));
      element.classList.add('selected');
      currentConfig.motif = element.getAttribute('data-motif');
      updatePreview();
    }

    // Vorschau aktualisieren
    function updatePreview() {
      if (!selectedImage) return;

      const canvas = document.getElementById('previewCanvas');
      const ctx = canvas.getContext('2d');
      
      // Canvas leeren
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Bild laden und zeichnen
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function() {
        // Bild skalieren und zentrieren
        const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
        const x = (canvas.width - img.width * scale) / 2;
        const y = (canvas.height - img.height * scale) / 2;
        
        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
        
        // Rahmen hinzufügen
        if (currentConfig.frame !== 'none') {
          ctx.strokeStyle = currentConfig.frame === 'classic' ? '#8B4513' : '#2c3e50';
          ctx.lineWidth = 8;
          ctx.strokeRect(x-4, y-4, img.width * scale + 8, img.height * scale + 8);
        }
        
        // Motiv hinzufügen
        if (currentConfig.motif !== 'none') {
          ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.font = '24px Arial';
          ctx.textAlign = 'center';
          const text = currentConfig.motif === 'heart' ? '❤️' : '⭐';
          ctx.fillText(text, canvas.width - 30, 40);
        }
      };
      img.src = selectedImage.url;
    }

    // In Warenkorb hinzufügen
    function addToCart() {
      if (!selectedImage) return;

      const item = {
        id: Date.now(),
        image: selectedImage,
        config: { ...currentConfig },
        price: PRICING[currentConfig.productType] || 0
      };

      cart.push(item);
      updateCartDisplay();
      showSuccess('Artikel wurde zum Warenkorb hinzugefügt');
    }

    // Warenkorb anzeigen
    function updateCartDisplay() {
      const cartSection = document.getElementById('cartSection');
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');

      if (cart.length === 0) {
        cartSection.style.display = 'none';
        return;
      }

      cartSection.style.display = 'block';
      cartItems.innerHTML = '';

      let total = 0;
      cart.forEach(item => {
        total += item.price;
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div>
            <strong>${item.image.filename}</strong><br>
            <small>${item.config.productType} - Rahmen: ${item.config.frame} - Motiv: ${item.config.motif}</small>
          </div>
          <div>
            €${item.price.toFixed(2)}
            <button onclick="removeFromCart(${item.id})" style="margin-left: 10px; background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Entfernen</button>
          </div>
        `;
        cartItems.appendChild(cartItem);
      });

      cartTotal.textContent = `€${total.toFixed(2)}`;
    }

    // Aus Warenkorb entfernen
    function removeFromCart(itemId) {
      cart = cart.filter(item => item.id !== itemId);
      updateCartDisplay();
    }

    // Checkout
    function checkout() {
      if (cart.length === 0) return;
      alert('Checkout-Prozess würde hier starten.\n\nGesamtbetrag: €' + cart.reduce((sum, item) => sum + item.price, 0).toFixed(2));
    }

    // Hilfsfunktionen
    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    function hideError() {
      document.getElementById('error').style.display = 'none';
    }

    function showSuccess(message) {
      const successDiv = document.createElement('div');
      successDiv.className = 'success';
      successDiv.textContent = message;
      document.querySelector('.main-content').insertBefore(successDiv, document.querySelector('.main-content').firstChild);
      setTimeout(() => successDiv.remove(), 3000);
    }

    // Enter-Taste für Suche
    document.getElementById('photoCode').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchPhotos();
      }
    });
  </script>
</body>
</html>